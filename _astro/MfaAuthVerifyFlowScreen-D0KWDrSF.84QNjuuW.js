import{dz as B,d5 as j,d4 as F,d6 as u}from"./app.Dbs6V_q1.js";import{r as s}from"./index.Crn7-fJZ.js";import{Q as P,R as V,z as D,X as S}from"./to-ui-error-fYkDcQhz.asSa8VyB.js";import"./PinInput-3SLvbnQa.DL2jOvCl.js";import"./FingerPrintIcon.f1l06IJ0.js";import"./PhoneIcon.BLDp5Qmc.js";import"./ShieldCheckIcon.C49qVTY6.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./ExclamationTriangleIcon.CbWlQoeb.js";import"./StackedContainer-B2vaEl56.CD0ocOGA.js";import"./useGetTokenPrice-YObgUU6L.Bdidc-9R.js";import"./useGetSolPrice-DwwjjGbd.Cs3YiPXK.js";import"./TransactionDetails-BMVu0qlz.59B78Oj6.js";import"./WalletLink-CZTmkBKu.CwUyBa3G.js";import"./ethers-DrSqg5wi.D-a06N_R.js";import"./getFormattedUsdFromLamports-B6EqSEho.C-HCdwKa.js";import"./transaction-CnfuREWo.DxjkYrBU.js";import"./Layouts-BlFm53ED.DNAcEX9b.js";import"./ChevronDownIcon.zw1eklKi.js";const te={component:()=>{let{user:l}=B(),y=j(),a=s.useMemo((()=>l?.mfaMethods.filter((e=>e!=="passkey"||!y.globalDisablePasskeys))??[]),[l?.mfaMethods,y.globalDisablePasskeys]),{data:h}=F(),[t,o]=s.useState(a[0]),[f,k]=s.useState(!1),[m,M]=s.useState(),[n,i]=s.useState();if(s.useEffect((()=>{o(a[0])}),[a]),!h?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:E,onSuccess:c,generateOptions:b,verifyTotpCode:C,verifyPasskey:v,verifySmsCode:x,sendSmsCode:A}=h.mfaVerify,g=async e=>{if(e!=="passkey")try{o(e),e==="sms"&&(o(e),await A()),e==="totp"&&o(e)}catch(r){console.error(r)}else try{o(e);let r=await b();if(!r)throw Error("something went wrong");M(r),await v(r),k(!0),i(void 0),c()}catch(r){i(S(r))}},w=async e=>{i(void 0);try{if(!e||!t)return;if(t==="passkey"){if(!m)throw Error("Missing passkey challenge");await v(m)}else t==="sms"?await x(e):t==="totp"&&await C(e);i(void 0),k(!0),c()}catch(r){throw S(r).error}},p=()=>{n||!f?E(n?.error??Error("Canceled MFA verification.")):c()},d=s.useRef(!1);return s.useEffect((()=>{!d.current&&t&&(d.current=!0,g(t).finally((()=>{d.current=!1})))}),[open]),l?t==="passkey"?u.jsx(P,{account:l.linkedAccounts.filter((e=>e.type==="passkey"&&e.enrolledInMfa)).sort(((e,r)=>r.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf()))[0],submitSuccess:f,hasBlockingError:n?.isBlocking??!1,error:n?.error,onClose:p,onBack:()=>{o(void 0),i(void 0)},handleSubmit:()=>w(m).catch(i)}):t==="sms"||t==="totp"?u.jsx(V,{selectedMethod:t,submitSuccess:f,hasBlockingError:n?.isBlocking??!1,handleSubmitCode:w,onClose:p,onBack:a.length>1?()=>o(void 0):void 0}):u.jsx(D,{mfaMethods:a,onSelect:g,handleClose:p}):null}};export{te as MfaAuthVerifyFlowScreen,te as default};

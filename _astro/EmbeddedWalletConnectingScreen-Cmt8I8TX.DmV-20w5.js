import{dz as F,d7 as P,d4 as V,dM as g,dN as M,d6 as A}from"./app.Dbs6V_q1.js";import{r as y}from"./index.Crn7-fJZ.js";import{n as U}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import{C as _}from"./circle-x.BeJGwV2A.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./createLucideIcon.RSj0tFkk.js";const N=({connectionFailed:i,onClose:s})=>A.jsx(U,i?{title:"Something went wrong",subtitle:"We're on it. Please try again later.",icon:_,iconVariant:"error",primaryCta:{label:"Close",onClick:s},watermark:!0}:{title:"Connecting to your wallet",subtitle:"Please wait...",iconVariant:"loading",showClose:!0,onClose:s,watermark:!1}),X={component:()=>{let{authenticated:i,user:s}=F(),{client:f,closePrivyModal:u,createAnalyticsEvent:m,walletProxy:o}=P(),{navigate:n,data:v,setModalData:I,onUserCloseViaDialogOrKeybindRef:E}=V(),x=y.useMemo((()=>Date.now()),[]),[w,S]=y.useState(!1),{onCompleteNavigateTo:t,onFailure:h,shouldForceMFA:T,entropyId:c,entropyIdVerifier:d,recoveryMethod:l,connectingWalletAddress:b,isUnifiedWallet:W=!1}=v?.connectWallet,e=r=>{w||(S(!0),h(typeof r=="string"?Error(r):r))};return y.useEffect((()=>{let r;return i?o?((async()=>{let p=await f.getAccessToken();if(!p)return e("User must be authenticated and have a Privy wallet before it can be connected");try{if(!W){if(!c||!d)return e("For on-device first-class chain wallets, entropyId and entropyIdVerifier are required");await o.connect({accessToken:p,entropyId:c,entropyIdVerifier:d})}T&&await o.verifyMfa({accessToken:p});let a=(Date.now()-x)/1e3;t==="EmbeddedWalletKeyExportScreen"&&a<1?r=setTimeout((()=>{n(t,!1)}),1e3*(1-a)):n(t,!1)}catch(a){if(g(a)&&l==="privy"){let C=await f.getAccessToken();if(!C)return e("User must be authenticated and have a Privy wallet before it can be recovered");try{m({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:b}}),(await o?.recover({accessToken:C,entropyId:c,entropyIdVerifier:d}))?.entropyId||e(Error("Unable to recover wallet")),t?n(t):u({shouldCallAuthOnSuccess:!1}),m({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:b}}),n(t)}catch{e("An error has occurred, please try again.")}}else g(a)&&l!=="privy"&&l!=="privy-v2"?(I({...v,recoverWallet:{entropyId:c,entropyIdVerifier:d,onCompleteNavigateTo:t,onFailure:h},recoveryOAuthStatus:{provider:l,action:"recover",isInAccountCreateFlow:!1,shouldCreateEth:!1,shouldCreateSol:!1}}),n(M(l))):e(a)}})(),()=>clearTimeout(r)):void 0:e("User must be authenticated and have a Privy wallet before it can be connected")}),[i,s,o]),E.current=()=>{e("User exited before wallet could be connected"),u({shouldCallAuthOnSuccess:!1})},A.jsx(N,{connectionFailed:w,onClose:()=>u({shouldCallAuthOnSuccess:!1})})}};export{X as EmbeddedWalletConnectingScreen,N as EmbeddedWalletConnectingView,X as default};

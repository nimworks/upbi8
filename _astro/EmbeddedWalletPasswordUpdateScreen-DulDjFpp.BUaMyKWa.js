import{dz as U,d7 as $,d4 as j,d5 as T,dU as R,dV as V,d6 as k,dW as L,dT as w}from"./app.Dbs6V_q1.js";import{r as a}from"./index.Crn7-fJZ.js";import{u as W,o as D}from"./SetWalletPasswordForm-lzuYpBex.Bg3CM1rE.js";import"./ExclamationTriangleIcon.CbWlQoeb.js";import"./Layouts-BlFm53ED.DNAcEX9b.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./shared-CQ6jg1BO.YFvMzRPg.js";import"./Checkbox-BhNoOKjX.CsfsqpBs.js";import"./CheckCircleIcon.BfpESmB8.js";import"./ScreenHeader-CHmc4-Lu.CDB8Kfz5.js";const Y={component:()=>{let[n,A]=a.useState(null),[P,y]=a.useState(!1),[l,o]=a.useState(null),[i,v]=a.useState(""),{authenticated:m,user:c}=U(),{client:b,walletProxy:h,refreshSessionAndUser:S,closePrivyModal:d,createAnalyticsEvent:r}=$(),{navigate:x,data:E,onUserCloseViaDialogOrKeybindRef:C}=j(),I=T(),{onSuccess:f,onFailure:u}=E.setWalletPassword,e=R(c),g=n?.recoveryMethod==="user-passcode",t=e?.recoveryMethod==="user-passcode";a.useEffect((()=>{m||(x("LandingScreen"),u(new V("User must be authenticated before setting a password on a Privy wallet")))}),[m]);let p=()=>l?(u(l),void d({shouldCallAuthOnSuccess:!1})):g?(f(n),void d({shouldCallAuthOnSuccess:!1})):(u(new w("Exited before password was added to wallet")),void d({shouldCallAuthOnSuccess:!1}));return C.current=p,k.jsx(W,{appName:I?.name||"privy",config:{initiatedBy:"user",onCancel:p},error:l?"An error has occurred, please try again.":void 0,buttonLoading:P,buttonHideAnimations:!1,password:i,isResettingPassword:t,onPasswordGenerate:()=>v(D()),onPasswordChange:v,onSubmit:async()=>{g?(f(n),d({shouldCallAuthOnSuccess:!1})):(y(!0),o(null),await(async()=>{let _=await b.getAccessToken();if(_&&c&&e?.address&&i&&h)try{r({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}});let{entropyId:s,entropyIdVerifier:N}=L(c);if(!(await h.setRecovery({accessToken:_,entropyId:s,entropyIdVerifier:N,recoveryPassword:i,recoveryMethod:"user-passcode"})).entropyId)return o(new w("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"error setting password"}});let O=await S(),M=R(O);if(!M)return o(new w("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"wallet disconnected"}});A(M),r({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}})}catch(s){console.warn(s),o(s instanceof Error?s:Error("Error setting password on privy wallet")),r({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:e.address,reason:s}})}})(),y(!1))},onClose:p})}};export{Y as EmbeddedWalletPasswordUpdateScreen,Y as default};

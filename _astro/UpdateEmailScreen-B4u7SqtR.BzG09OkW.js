import{d6 as e,dz as y,d7 as A,d4 as v,dp as U,d5 as C,e2 as M,e3 as T}from"./app.Dbs6V_q1.js";import{F as $}from"./EnvelopeIcon.INHBpgwr.js";import{e as P}from"./Layouts-BlFm53ED.DNAcEX9b.js";import{r as o}from"./index.Crn7-fJZ.js";import{V as q,m as D}from"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import{t as R,e as F}from"./EmailInputForm-Dgoii4vf.BrQcx02d.js";import{e as I}from"./ErrorMessage-D8VaAP5m.NPlgZ3Xt.js";import{n as L}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import{M as N}from"./mail.CyTFkYLK.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./createLucideIcon.RSj0tFkk.js";const V=o.forwardRef(((s,d)=>{let[r,S]=o.useState(""),[t,c]=o.useState(""),[l,u]=o.useState(!1),{authenticated:g,user:i}=y(),{initUpdateEmail:p}=A(),{navigate:n,setModalData:f,currentScreen:w}=v(),{enabled:j,token:h}=U(),k=C(),E=M(r)&&(k.disablePlusEmails&&r.includes("+")?(t||c("Please enter a valid email address without a '+'."),!1):(t&&c(""),!0)),x=l||!E,m=()=>{!j||h||g?(async a=>{if(!i?.email)throw Error("User is required to have an email address to update it.");u(!0);try{await p({oldAddress:i.email.address,newAddress:r,captchaToken:a}),n("AwaitingPasswordlessCodeScreen")}catch(b){f({errorModalData:{error:b,previousScreen:w||"LandingScreen"}}),n("ErrorScreen")}u(!1)})(h):(f({captchaModalData:{callback:a=>{if(!i?.email)throw Error("User is required to have an email address to update it.");return p({oldAddress:i.email.address,newAddress:r,captchaToken:a})},userIntentRequired:!1,onSuccessNavigateTo:"AwaitingPasswordlessCodeScreen",onErrorNavigateTo:"ErrorScreen"}}),n("CaptchaScreen"))};return e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[t&&e.jsx(I,{style:{marginTop:"0.25rem",textAlign:"left"},children:t}),e.jsxs(z,{$error:!!t,children:[e.jsx(T,{children:e.jsx(N,{})}),e.jsx("input",{ref:d,id:"email-input",type:"email",placeholder:"your@email.com",onChange:a=>S(a.target.value),onKeyUp:a=>{a.key==="Enter"&&m()},value:r,autoComplete:"email"}),s.stacked?null:e.jsx(q,{isSubmitting:l,onClick:m,disabled:x,children:"Submit"})]})]}),s.stacked?e.jsx(D,{loadingText:null,loading:l,disabled:x,onClick:m,style:{width:"100%"},children:"Submit"}):null]})}));let W=R,z=F;const K=({title:s="Update your email",subtitle:d="Add the email address you'd like to use going forward. We'll send you a confirmation code"})=>e.jsx(L,{title:s,subtitle:d,icon:$,watermark:!0,children:e.jsx(P,{children:e.jsx(V,{stacked:!0})})}),re={component:()=>e.jsx(K,{})};export{re as UpdateEmailScreen,K as UpdateEmailScreenView,re as default};

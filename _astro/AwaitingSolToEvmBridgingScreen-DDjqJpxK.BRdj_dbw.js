import{d5 as U,d7 as z,d4 as G,dj as J,de as s,dk as X,dl as b,dc as Z,dm as j,dn as I,da as m,dh as ee,d6 as e}from"./app.Dbs6V_q1.js";import{F as ne}from"./CheckCircleIcon.DG4NyxCY.js";import{r}from"./index.Crn7-fJZ.js";import{c as te,n as ae,s as re}from"./Layouts-BlFm53ED.DNAcEX9b.js";import{b as R}from"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import{o as se}from"./ScreenHeader-CHmc4-Lu.CDB8Kfz5.js";import{t as k}from"./FundWalletMethodHeader-Dujd1j7J.DOTw7rnz.js";import{t as oe}from"./index-Dq_xe9dz.CYFAvuPJ.js";import{t as ie}from"./analytics-mkkvFRju.DOXuftJB.js";import{u as de,o as le,f as ce,n as ue,s as me,r as fe}from"./reservoir-0wfhnc0j.e4oV4U26.js";import{I as pe}from"./TransferOrBridgeLoadingScreen-gM_oel5i.B9Paf-ub.js";import{p as ge}from"./parseEther.DWtwDPWT.js";import"./InjectedWalletIcon-DLcYOGDj.CyAbXwSp.js";import"./WalletIcon.DW8etFtk.js";import"./Value-tcJV9e0L.CCQPdIyi.js";import"./LoadingSkeleton-U6-3yFwI.DhgKuR2U.js";import"./Address-BuCMjci7.5xYW3BaW.js";import"./check.BWO2M5QN.js";import"./createLucideIcon.RSj0tFkk.js";import"./copy.Ukg_M5w7.js";import"./GlobeAltIcon.TtWhTJWd.js";import"./parseUnits.Di_CbW2l.js";const Be={component:function(){let D=U(),{closePrivyModal:P,createAnalyticsEvent:W,connectors:C}=z(),{navigate:B,setModalData:L,data:o}=G(),x=U(),y=r.useRef(!1),E=J(),[F,h]=r.useState(!1),[w,_]=r.useState(!1),[v,d]=r.useState(null),[M,O]=r.useState(),[q,$]=r.useState();if(!o?.funding||o.funding.chainType!=="ethereum")throw Error("Invalid funding data");let{amount:f,connectedWallet:p,chain:l,solanaChain:H,isUSDC:g}=o.funding,S=o.funding.address,K=o.funding.erc20Address,A=o.funding.isUSDC?"USDC":l.nativeCurrency.symbol,t=r.useMemo((()=>p?.type==="solana"?p.provider:(function({connectors:n,connectedWalletAddress:i}){let c=n.find((a=>a.chainType==="solana"&&a.wallets.some((T=>T.address===i)))),u=c?.wallet.accounts.find((a=>a.address===i));if(!c||!u)throw new s("Unable to find source wallet connector");return new X({wallet:c.wallet,account:u})})({connectors:C,connectedWalletAddress:p?.address||""})),[p,C]),N=r.useMemo((()=>{let n=E(b);if(!n)throw new s("Unable to load solana plugin");let i=D.solanaRpcs["solana:mainnet"];if(!i)throw new s("Unable to load mainnet RPC");return n.getSolanaRpcClient({rpc:i.rpc,rpcSubscriptions:i.rpcSubscriptions,chain:"solana:mainnet",blockExplorerUrl:i.blockExplorerUrl??"https://explorer.solana.com"})}),[]),Q=Z(j(t?.standardWallet.name||"unknown")),V=Q?.name||"wallet";return r.useEffect((()=>{(async function(){if(!t||!l||y.current)return;let n=E(b);if(!n)return void d(new s("Unable to solana plugin"));y.current=!0,l?.testnet&&console.warn("Solana testnets are not supported for bridging");let i=g?1e6*parseFloat(f):ge(f),c=await de({isTestnet:!!l.testnet,input:le({appId:x.id,amount:i.toString(),user:t.address,recipient:S,destinationChainId:l.id,originChainId:fe,originCurrency:g?ue:me,destinationCurrency:g?K:void 0})}).catch(console.error);if(!c)return void d(new s(`Unable to fetch quotes for bridging. Wallet ${I(t.address)} does not have enough funds.`,void 0,m.INSUFFICIENT_BALANCE));let u=await n.createTransactionFromRelayQuote({quote:c,source:t.address,solanaClient:N});if(u)try{h(!0);let a=await n.simulateTransaction({solanaClient:N,tx:u});if(a.hasError)return a.hasFunds?(console.error("Transaction failed:",a.error),void d(new s("Something went wrong",void 0,m.TRANSACTION_FAILURE))):void d(new s(`Wallet ${I(t?.address)} does not have enough funds. ${c.details.currencyIn.amountFormatted} ${A} are needed to complete the transaction.`,void 0,m.INSUFFICIENT_BALANCE));let{signature:T}=await t.signAndSendTransaction({chain:"solana:mainnet",transaction:u}),Y=n.getAddressFromBuffer(T);O(Y),$("pending")}catch(a){if(console.error(a),/user rejected the request/gi.test(a.message||""))return void d(new s("Transaction was rejected by the user",void 0,m.TRANSACTION_FAILURE));d(new s("Something went wrong",void 0,m.TRANSACTION_FAILURE))}else d(new s(`Unable to select bridge option from quotes. Wallet ${I(t.address)} does not have enough funds.`,void 0,m.INSUFFICIENT_BALANCE))})().catch(console.error)}),[]),ce({transactionHash:M,isTestnet:!1,bridgingStatus:q,setBridgingStatus:$,onSuccess({transactionHash:n}){h(!1),_(!0),W({eventName:ie,payload:{provider:"external",status:"success",txHash:n,address:t.address,chainType:"solana",clusterName:H,token:"SOL",destinationAddress:S,destinationChainId:l.id,destinationChainType:"ethereum",destinationValue:f,destinationToken:g?"USDC":"ETH"}})},onFailure({error:n}){h(!1),d(n)}}),r.useEffect((()=>{if(!w)return;let n=setTimeout(P,ee);return()=>clearTimeout(n)}),[w]),r.useEffect((()=>{v&&(L({funding:o?.funding,solanaFundingData:o?.solanaFundingData,sendTransaction:o?.sendTransaction,errorModalData:{error:v,previousScreen:"TransferFromWalletScreen"}}),B("ErrorScreen",!1))}),[v]),w?e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(te,{}),e.jsxs(ae,{children:[e.jsx(ne,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),e.jsx(se,{title:"Success!",description:`Youâ€™ve successfully added ${f} ${A} to your ${x.name} wallet. It may take a minute before the funds are available to use.`})]}),e.jsx(re,{}),e.jsx(R,{})]}):F&&t?e.jsx(pe,{walletClientType:j(t?.standardWallet.name||"unknown"),displayName:V,addressToFund:S,isBridging:F,isErc20Flow:!1,chainId:l.id,chainName:l.name,totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(oe,{}),e.jsx("div",{style:{marginTop:"1rem"}}),e.jsx(R,{})]})}};export{Be as AwaitingSolToEvmBridgingScreen,Be as default};

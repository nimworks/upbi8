import{d4 as I,d5 as S,dz as K,d7 as M,dS as j,dY as k,dZ as V,eO as F,dK as L,d6 as b,dT as D}from"./app.Dbs6V_q1.js";import{r as u}from"./index.Crn7-fJZ.js";import{n as Y}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import{C as Z}from"./circle-x.BeJGwV2A.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./createLucideIcon.RSj0tFkk.js";async function g(r,a){let l=`${r}-auto-${a==="ethereum"?"eth":"sol"}`,d=new TextEncoder().encode(l);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",d))).map((s=>s.toString(16).padStart(2,"0"))).join("")}const q=({errorMessage:r,onClose:a})=>b.jsx(Y,r?{title:"Something went wrong",subtitle:r,icon:Z,iconVariant:"error",primaryCta:{label:"Close",onClick:a},watermark:!0}:{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),_={component:()=>{let{setModalData:r,navigate:a,data:l,onUserCloseViaDialogOrKeybindRef:d}=I(),s=S(),[v,O]=u.useState(""),{embeddedWallets:x}=S(),{authenticated:m,user:e}=K(),{closePrivyModal:c,walletProxy:A,client:W}=M(),{onSuccess:E,onFailure:w,callAuthOnSuccessOnClose:y,shouldCreateEth:U,shouldCreateSol:P}=l.createWallet,h=s.embeddedWallets.mode==="legacy-embedded-wallets-only"&&s?.embeddedWallets.requireUserOwnedRecoveryOnCreate===!0,[p,R]=u.useState(null),{create:o}=j(),n=U??(!!e&&k(e,s.embeddedWallets.ethereum.createOnLogin)),i=P??(!!e&&V(e,s.embeddedWallets.solana.createOnLogin)),T=new L((async()=>{let $=await W.getAccessToken();if(e&&$&&A)try{let t,C=await g(e.id,"ethereum"),f=await g(e.id,"solana");if(n&&i)t=await o({chainType:"ethereum",walletIndex:0,latestUser:e,idempotencyKey:C}),t=await o({chainType:"solana",walletIndex:0,latestUser:t.user,idempotencyKey:f});else if(i)t=await o({chainType:"solana",walletIndex:0,latestUser:e,idempotencyKey:f});else{if(!n)return void c({shouldCallAuthOnSuccess:y});t=await o({chainType:"ethereum",walletIndex:0,latestUser:e,idempotencyKey:C})}R(t),a("EmbeddedWalletCreatedScreen")}catch(t){O(t.message)}}));return u.useEffect((()=>m&&e?h?(r({...l,createWallet:{...l.createWallet,shouldCreateEth:n,shouldCreateSol:i},recoverySelection:{...l?.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:n,shouldCreateSol:i}}),a(F({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:x.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void T.execute():(a("LandingScreen"),void w(Error("User must be authenticated before creating a Privy wallet")))),[h,m]),d.current=()=>null,b.jsx(q,{errorMessage:v||void 0,onClose:()=>{p?(E(p),c({shouldCallAuthOnSuccess:y})):(w(new D("User wallet creation failed")),c({shouldCallAuthOnSuccess:!1}))}})}};export{_ as EmbeddedWalletOnAccountCreateScreen,q as EmbeddedWalletOnAccountCreateView,_ as default};

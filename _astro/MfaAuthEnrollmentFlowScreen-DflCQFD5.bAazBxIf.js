import{dz as G,d4 as J,d5 as Q,d6 as e,ds as X}from"./app.Dbs6V_q1.js";import{T as y,g as x,F as U,m as M}from"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import{F as Y}from"./ShieldCheckIcon.C49qVTY6.js";import{r as l}from"./index.Crn7-fJZ.js";import{t as Z,f as _,l as ee,i as te}from"./EnrollTotp-DlnMoeNk.CNEqpKfh.js";import{a as oe,d as re,w as F,l as C,p as R,m as S}from"./PinInput-3SLvbnQa.DL2jOvCl.js";import"./QrCode-BkoTqsec.Ok9nSJBs.js";import"./FingerPrintIcon.f1l06IJ0.js";import"./PhoneIcon.BLDp5Qmc.js";import"./Chip-D2-wZOHJ.DezdPRVM.js";import"./LoadingSkeleton-U6-3yFwI.DhgKuR2U.js";import"./ErrorScreen-8UMMZ6is.0ylxDhjt.js";import"./reservoir-0wfhnc0j.e4oV4U26.js";import"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./createLucideIcon.RSj0tFkk.js";import"./lock.RVFbxoA7.js";import"./LinkPasskeyScreen-jzRj6Yq0.CHUIblrj.js";import"./TodoList-CgrU7uwu.CdzoNajJ.js";import"./check.BWO2M5QN.js";import"./circle-check-big.BEG3gtjL.js";import"./fingerprint-pattern.Bk_3pvPW.js";import"./CopyToClipboard-BGTSFnT3.DJJyG0Dp.js";import"./copy-Bx2Jwc5_.DotTa6qt.js";import"./Layouts-BlFm53ED.DNAcEX9b.js";import"./LabelXs-oqZNqbm_.5zQfQihM.js";import"./Subtitle-CV-2yKE4.DJhYHDeo.js";import"./Title-BnzYV3Is.B74pnAvd.js";import"./shared-FM0rljBt.uRznKemR.js";import"./dijkstra.COg3n3zL.js";const Be={component:()=>{let{user:s,ready:B}=G(),{data:j,onUserCloseViaDialogOrKeybindRef:I}=J(),m=Q(),[v,i]=l.useState(null),[h,p]=l.useState(null),[g,k]=l.useState(null),[L,O]=l.useState(!1),[b,n]=l.useState(!1),[f,r]=l.useState(),a=async()=>{f?E(f):s?await c({user:s}):E(Error("Must be logged in to manage MFA")),setTimeout((()=>{i(null),p(null)}),500)};if(I.current=a,!j?.mfaEnroll)throw Error("Missing modal data for MFA enrollment screen.");let{onFailure:E,onSuccess:c,onBack:w,mfaMethods:W,verify:A,generateTotpSecret:z,enrollTotp:D,unenrollTotp:H,enrollPasskey:T}=j.mfaEnroll,K=s?.mfaMethods.includes("sms"),N=s?.mfaMethods.includes("totp"),V=s?.mfaMethods.includes("passkey"),q=!!s?.phone,$=s?.linkedAccounts.filter((t=>t.type==="passkey")).map((t=>t.credentialId))??[];function d(){i(null),p(null),r(void 0)}async function P(t=$){try{r(void 0),n(!0);let o=await T(t);return await c({user:o})}catch(o){r(o)}finally{n(!1),O(!1)}}if(!B||!s||!m)return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:a,backFn:w},"header"),e.jsx(oe,{children:e.jsx(Z,{})}),e.jsx(re,{children:e.jsx(X,{})}),e.jsx(x,{})]});if(v==="sms")return null;if(v==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:d,onClose:a},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(U,{})}),e.jsx(C,{children:"Remove authenticator app verification?"}),e.jsxs(R,{children:["MFA adds an extra layer of security to your ",m?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(S,{children:e.jsx(M,{$warn:!0,onClick:async function(){try{r(void 0),n(!0);let t=await H();return await c({user:t})}catch(t){r(t)}finally{n(!1),i(null)}},loading:b,children:"Remove"})}),e.jsx(x,{})]});if(v==="passkey"){let t=j.mfaEnroll.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:d,onClose:a},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(U,{})}),e.jsx(C,{children:"Are you sure you want to remove this passkey?"}),e.jsx(R,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(S,{children:e.jsx(M,{$warn:!0,onClick:async function(){try{r(void 0),n(!0);let o=await T([]);return await c({user:o})}catch(o){r(o)}finally{n(!1),i(null)}},loading:b,children:"Remove"})}),e.jsx(x,{})]})}return W.length!==0||K||N||V?h==="sms"?null:h==="totp"&&g?e.jsx(_,{onClose:a,onReset:d,submitEnrollmentWithTotp:t=>(async function(o){try{r(void 0),n(!0);let u=await D(o);return await c({user:u})}catch(u){r(u)}finally{n(!1),i(null)}})(t.mfaCode),error:f,totpInfo:{...g,appName:m?.name||"Privy"}}):h==="passkey"?e.jsx(ee,{onReset:d,onClose:a,submitEnrollmentWithPasskey:P}):e.jsx(te,{showIntro:!0,userMfaMethods:s.mfaMethods,appMfaMethods:m.mfa.methods,userHasAuthSms:q,backFn:w,handleSelectMethod:async function(t){r(void 0);try{await A()}catch(o){return void r(o)}return t==="totp"?(p(t),k(null),void z().then((({totpSecret:o,totpAuthUrl:u})=>{k({authUrl:u,secret:o})})).catch((()=>{k(null),d()}))):t==="passkey"&&$.length===1?await P():void p(t)},isTotpLoading:h==="totp"&&!g,isPasskeyLoading:L,error:f,onClose:a,setRemovingMfaMethod:async function(t){r(void 0);try{await A()}catch(o){return void r(o)}i(t)}}):e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:a,backFn:w},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(C,{children:"Add more security"}),e.jsxs(R,{children:[m?.name," does not have any verification methods enabled."]}),e.jsx(S,{children:e.jsx(M,{onClick:a,children:"Close"})}),e.jsx(x,{})]})}};export{Be as MfaAuthEnrollmentFlowScreen,Be as default};

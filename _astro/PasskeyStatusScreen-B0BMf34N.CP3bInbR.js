import{d4 as A,d5 as C,d7 as _,dz as b,dv as m,d6 as d,d9 as O,da as g,dr as T}from"./app.Dbs6V_q1.js";import{r as t}from"./index.Crn7-fJZ.js";import{a as x}from"./shouldProceedtoEmbeddedWalletCreationFlow-BfZwb-3N.vvASFTgn.js";import{n as W}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import{F}from"./fingerprint-pattern.Bk_3pvPW.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./createLucideIcon.RSj0tFkk.js";const j=({status:e,passkeySignupFlow:i=!1,error:s,onRetry:a})=>d.jsx(W,{title:(()=>{switch(e){case"loading":return"Waiting for passkey";case"success":return"Success";case"error":return"Something went wrong"}})(),subtitle:d.jsx(R,{children:(()=>{switch(e){case"loading":return i?"Please follow prompts to register your passkey.":`Please follow prompts to verify your passkey.
You will have to sign up with another method first to register a passkey for your account.`;case"success":return"You've successfully logged in with your passkey.";case"error":if(s instanceof O){if(s.privyErrorCode===g.CANNOT_LINK_MORE_OF_TYPE)return"Cannot link more passkeys to account.";if(s.privyErrorCode===g.PASSKEY_NOT_ALLOWED)return`Passkey request timed out or rejected by user.
You will have to sign up with another method first to register a passkey for your account.`}return`An unknown error occurred.
You will have to sign up with another method first to register a passkey for your account.`}})()}),icon:F,iconVariant:"loading",iconLoadingStatus:{success:e==="success",fail:e==="error"},primaryCta:e==="error"&&a?{label:"Retry",onClick:a}:e==="success"?{label:"Continue",disabled:!0}:void 0,watermark:!0}),z={component:()=>{let{data:e,setModalData:i,navigate:s}=A(),a=C(),{loginWithPasskey:h,signupWithPasskey:w,closePrivyModal:k,createAnalyticsEvent:S}=_(),{user:o,logout:v}=b(),{passkeySignupFlow:p}=e?.passkeyAuthModalData??{},f=m-500,[u,c]=t.useState("loading"),[E,P]=t.useState(null),n=t.useRef([]),l=r=>{n.current=[r,...n.current]};t.useEffect((()=>()=>{n.current.forEach((r=>clearTimeout(r))),n.current=[]}),[]);let y=async()=>{c("loading");try{p?await w():await h(),c("success")}catch(r){P(r),c("error")}};return t.useEffect((()=>{if(u==="success"&&o){if(a?.legal.requireUsersAcceptTerms&&!o.hasAcceptedTerms)return void l(setTimeout((()=>{s("AffirmativeConsentScreen")}),f));if(!x(o,a?.embeddedWallets))return void l(setTimeout((()=>{k({shouldCallAuthOnSuccess:!0,isSuccess:!0})}),m));l(setTimeout((()=>{i({createWallet:{onSuccess:()=>{},onFailure:r=>{console.error(r),S({eventName:"embedded_wallet_creation_failure_logout",payload:{error:r,screen:"PasskeyStatusScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),s("EmbeddedWalletOnAccountCreateScreen")}),f))}}),[o,u]),t.useEffect((()=>{y()}),[]),d.jsx(j,{status:u,passkeySignupFlow:p,error:E,onRetry:y})}};let R=T.span`
  white-space: pre-wrap;
`;export{z as PasskeyStatusScreen,j as PasskeyStatusScreenView,z as default};

import{d5 as I,d4 as T,d7 as U,dJ as E,de as A,dK as $,dv as h,d6 as C,dL as x,da as O}from"./app.Dbs6V_q1.js";import{r as d}from"./index.Crn7-fJZ.js";import{a as R}from"./shouldProceedtoEmbeddedWalletCreationFlow-BfZwb-3N.vvASFTgn.js";import{n as _}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";const k=({providerApp:a,success:s,error:r,onClose:c})=>{let{title:i,subtitle:u}=d.useMemo((()=>s?{title:`Successfully connected with ${a.name}`,subtitle:"You're good to go!"}:r?{title:"Authentication failed",subtitle:r.message}:{title:`Connecting to ${a.name}`,subtitle:`Please check the pop-up from ${a.name} to continue`}),[s,r,a.name]);return C.jsx(_,{title:i,subtitle:u,icon:a.logoUrl,iconVariant:"loading",iconLoadingStatus:{success:s,fail:!!r},onBack:c,watermark:!0})},K={component:()=>{let a=I(),{data:s,navigate:r,setModalData:c,onUserCloseViaDialogOrKeybindRef:i}=T(),{crossAppAuthFlow:u,updateWallets:y,closePrivyModal:g,createAnalyticsEvent:b}=U(),{logout:v}=E(),[o,n]=d.useState({}),e=s?.crossAppAuth,p=new A(`There was an issue connecting your ${e?.name} account. Please try again.`),w=new $((async l=>{if(e?.popup)try{let t=await u({appId:l,popup:e.popup,action:e.action,disableSignup:e.disableSignup});n({data:t})}catch(t){if(t instanceof A)n({error:t});else if(t instanceof x){if(t.privyErrorCode===O.ACCOUNT_TRANSFER_REQUIRED&&t.data?.data?.nonce)return c({accountTransfer:{nonce:t.data?.data?.nonce,account:t.data?.data?.subject,displayName:t.data?.data?.account?.displayName,linkMethod:`privy:${e.appId}`,embeddedWalletAddress:t.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:t.data?.data?.otherUser?.oAuthUserInfo}}),void r("LinkConflictScreen");e.popup&&e.popup.close(),n({error:p})}else n({error:p})}else n({error:p})})),m=()=>{o.data&&(y(),e?.onSuccess(o.data),g({shouldCallAuthOnSuccess:!0,isSuccess:!0})),e?.onError(o.error??new A("User canceled flow")),g({shouldCallAuthOnSuccess:!1,isSuccess:!1})};return i.current=m,d.useEffect((()=>{e?.appId?.length&&w.execute(e.appId)}),[e?.appId]),d.useEffect((()=>{if(!o.data)return;let l=o.data;if(a.legal.requireUsersAcceptTerms&&!l.hasAcceptedTerms){let f=setTimeout((()=>{r("AffirmativeConsentScreen")}),h);return()=>clearTimeout(f)}if(R(l,a.embeddedWallets)){let f=setTimeout((()=>{c({createWallet:{onSuccess:()=>{},onFailure:S=>{console.error(S),b({eventName:"embedded_wallet_creation_failure_logout",payload:{error:S,provider:`privy:${e?.appId}`,screen:"CrossAppAuthScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),r("EmbeddedWalletOnAccountCreateScreen")}),h);return()=>clearTimeout(f)}let t=setTimeout(m,h);return()=>clearTimeout(t)}),[o.data]),e?.appId?C.jsx(k,{providerApp:{id:e?.appId,logoUrl:e?.logoUrl,name:e?.name},success:!!o.data,error:o.error,onClose:m}):(console.warn("Missing data for Screen"),null)},isShownBeforeReady:!0};export{K as CrossAppAuthScreen,k as CrossAppAuthScreenView,K as default};

import{d4 as E,dp as I,d6 as k,dq as q}from"./app.Dbs6V_q1.js";import{r as t}from"./index.Crn7-fJZ.js";import{n as A}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import{C as P}from"./circle-check-big.BEG3gtjL.js";import{C as M}from"./circle-x.BeJGwV2A.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./createLucideIcon.RSj0tFkk.js";const j=({status:r,title:f,description:o,userIntentRequired:g,retriesRemaining:a,hasSelectedCta:n,onContinue:u,onRetry:c})=>{let l=t.useMemo((()=>{switch(r){case"loading":default:return;case"success":return g?{label:n?"Continuing...":"Continue",onClick:u,disabled:n,loading:n}:void 0;case"error":return a>0?{label:"Retry",onClick:c}:void 0}}),[r,n,u,c]),i=t.useMemo((()=>({loading:"loading",ready:"subtle",disabled:"subtle",success:"success",error:"error"})[r]||"loading"),[r]);return k.jsx(A,{icon:r==="loading"||r==="ready"?void 0:r==="success"?P:M,iconVariant:i,title:f,subtitle:o,primaryCta:l,watermark:!0})},$={component:()=>{let{lastScreen:r,data:f,navigate:o,setModalData:g}=E(),{status:a,token:n,waitForResult:u,reset:c,execute:l}=I(),i=t.useRef([]),p=e=>{i.current=[e,...i.current]},[S,w]=t.useState(!0);t.useEffect((()=>(p(setTimeout(w,1e3,!1)),()=>{i.current.forEach((e=>clearTimeout(e))),i.current=[]})),[]);let[T,C]=t.useState(""),[v,y]=t.useState("Checking that you are a human..."),[R,b]=t.useState(!1),[h,x]=t.useState(3),s=f?.captchaModalData,d=async e=>{try{await s?.callback(e),s?.onSuccessNavigateTo&&o(s?.onSuccessNavigateTo,!1)}catch(m){if(m instanceof q)return;g({errorModalData:{error:m,previousScreen:r||"LandingScreen"}}),o(s?.onErrorNavigateTo||"ErrorScreen",!1)}};return t.useEffect((()=>{a==="success"?p(setTimeout((async()=>{let e=await u();!e||s?.userIntentRequired||d(e)}),1e3)):a==="ready"&&p(setTimeout((()=>{a==="ready"&&l()}),500))}),[a]),t.useEffect((()=>{if(!S)switch(a){case"success":C("Success!"),y("CAPTCHA passed successfully."),s?.userIntentRequired||setTimeout((()=>{b(!0),d(n)}),2e3);break;case"loading":C(""),y("Checking that you are a human...");break;case"error":C("Something went wrong"),y(h<=0?"If you use an adblocker or VPN, try disabling and re-attempting.":"You did not pass CAPTCHA. Please try again.")}}),[a,S,R]),k.jsx(j,{status:a,title:T,description:v,userIntentRequired:s?.userIntentRequired,retriesRemaining:h,hasSelectedCta:R,onContinue:()=>{b(!0),d(n)},onRetry:async()=>{if(h<=0)return;x((m=>m-1)),c(),l();let e=await u();!e||s?.userIntentRequired||d(e)}})}};export{$ as CaptchaScreen,j as CaptchaScreenView,$ as default};

import{d4 as A,d5 as I,dS as M,dz as W,d7 as R,d6 as j,dK as L,dT as S}from"./app.Dbs6V_q1.js";import{r as a}from"./index.Crn7-fJZ.js";import{u as $,o as z}from"./SetWalletPasswordForm-lzuYpBex.Bg3CM1rE.js";import"./ExclamationTriangleIcon.CbWlQoeb.js";import"./Layouts-BlFm53ED.DNAcEX9b.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./shared-CQ6jg1BO.YFvMzRPg.js";import"./Checkbox-BhNoOKjX.CsfsqpBs.js";import"./CheckCircleIcon.BfpESmB8.js";import"./ScreenHeader-CHmc4-Lu.CDB8Kfz5.js";const Z={component:()=>{let{navigate:d,data:v,onUserCloseViaDialogOrKeybindRef:C}=A(),P=I(),[g,x]=a.useState(""),[u,c]=a.useState(!1),[s,h]=a.useState(),[n,b]=a.useState(null),{create:r}=M(),{authenticated:m,user:o}=W(),{closePrivyModal:l,isNewUserThisSession:E,initializeWalletProxy:U}=R(),{onSuccess:w,onFailure:i,callAuthOnSuccessOnClose:p,shouldCreateEth:f,shouldCreateSol:y}=v.createWallet,[t,O]=a.useState(null),T=new L((async()=>{try{let e;if(f&&y)e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"ethereum",walletIndex:0,latestUser:o}),e=await r({chainType:"solana",walletIndex:0,latestUser:e.user});else if(y)e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"solana",walletIndex:0,latestUser:o});else{if(!f)throw Error("Invalid args to create wallet");e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"ethereum",walletIndex:0,latestUser:o})}O(e),E?d("EmbeddedWalletCreatedScreen"):(w(e),l({shouldCallAuthOnSuccess:p}))}catch(e){x(e.message)}}));return a.useEffect((()=>{n||U(3e4).then((e=>b(e)))}),[n]),a.useEffect((()=>{if(!m||!o)return d("LandingScreen"),void i(Error("User must be authenticated before creating a Privy wallet"))}),[m]),C.current=()=>null,j.jsx($,{config:{initiatedBy:"automatic"},appName:P?.name||"privy",loading:!n,buttonLoading:u,buttonHideAnimations:!t&&u,isResettingPassword:!1,error:g,password:s||"",onClose:()=>{t&&t.account.recoveryMethod!=="user-passcode"?(i(new S("User created a wallet but failed to set a password for it")),l({shouldCallAuthOnSuccess:!1})):t?(w(t),l({shouldCallAuthOnSuccess:p})):(i(new S("User wallet creation failed")),l({shouldCallAuthOnSuccess:!1}))},onPasswordChange:h,onPasswordGenerate:()=>h(z()),onSubmit:async()=>(c(!0),T.execute().then((()=>new Promise((e=>setTimeout(e,250))))).finally((()=>c(!1))))})}};export{Z as EmbeddedWalletPasswordCreateScreen,Z as default};

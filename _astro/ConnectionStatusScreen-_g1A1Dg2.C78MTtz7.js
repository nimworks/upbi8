import{dy as C,dz as F,d4 as we,d5 as me,d7 as he,dj as ye,dp as Ce,dc as Ee,dx as y,dA as be,dB as V,dC as _e,dv as G,dD as j,d6 as m,dw as Te,dE as Re,da as E,dF as ve,dG as ke,dH as J,dI as Ae,ci as Ie,b_ as We,dr as Le}from"./app.Dbs6V_q1.js";import{r as a}from"./index.Crn7-fJZ.js";import{n as Q}from"./Link-DJ5gq9Di.Cl2blr2u.js";import{n as ee}from"./useI18n-VPW2SjZN.Cz-gwxDA.js";import{a as Oe}from"./shouldProceedtoEmbeddedWalletCreationFlow-BfZwb-3N.vvASFTgn.js";import{n as Ue}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";const Z=i=>{let c=localStorage.getItem("-walletlink:https://www.walletlink.org:Addresses")?.split(" ").filter((s=>Ie(s,{strict:!0}))).map((s=>We(s)));return!!c?.length&&!!i?.linkedAccounts.filter((s=>s.type=="wallet"&&c.includes(s.address))).length},Me=i=>i?.privyErrorCode===E.LINKED_TO_ANOTHER_USER?C.ERROR_USER_EXISTS:i instanceof ve&&!i.details.default?i.details:i instanceof ke?C.ERROR_TIMED_OUT:i?.privyErrorCode===E.CANNOT_LINK_MORE_OF_TYPE?C.ERROR_USER_LIMIT_REACHED:C.ERROR_WALLET_CONNECTION,xe=({walletLogo:i,title:c,subtitle:s,signSuccess:g,errorMessage:d,connectSuccess:u,separateConnectAndSign:b,signing:R,walletConnectRedirectUri:v,walletConnectFallbackUniversalUri:l,hasTabbedAway:k,showCoinbaseWalletResetCta:A,numRetries:U,onBack:h,onSign:p,onRetry:I,onCoinbaseReset:_,onDifferentWallet:f})=>{let{t:e}=ee(),M=A?{label:"Use a different wallet",onClick:_,disabled:g}:d===C.ERROR_USER_EXISTS&&h?{label:"Use a different wallet",onClick:f}:u&&!g&&b?{label:R?"Signing":"Sign with your wallet",onClick:p,disabled:R}:!g&&d?.retryable&&U<2?{label:"Retry",onClick:I,disabled:!1}:g||d?void 0:{label:e("connectionStatus.connecting"),onClick:()=>{},disabled:!0};return m.jsx(Ue,{title:c,subtitle:s,icon:i,iconVariant:"loading",iconLoadingStatus:{success:g,fail:!!d},primaryCta:M,onBack:h,watermark:!0,children:!u&&v&&!k&&m.jsxs(Ne,{children:[e("connectionStatus.stillHere")," ",m.jsx(Q,{href:v,target:"_blank",variant:"underlined",size:"sm",children:e("connectionStatus.tryConnectingAgain")}),l&&m.jsxs(m.Fragment,{children:[" ",e("connectionStatus.or")," ",m.jsx(Q,{href:l,target:"_blank",variant:"underlined",size:"sm",children:e("connectionStatus.useDifferentLink")})]})]})})},Pe={component:()=>{let i,[c,s]=a.useState(!1),[g,d]=a.useState(!1),[u,b]=a.useState(void 0),{authenticated:R,logout:v}=F(),{navigate:l,navigateBack:k,lastScreen:A,currentScreen:U,setModalData:h,data:p}=we(),I=me(),{t:_}=ee(),{getAuthFlow:f,walletConnectionStatus:e,closePrivyModal:M,initLoginWithWallet:B,loginWithWallet:te,updateWallets:ne,createAnalyticsEvent:ae}=he(),{walletConnectors:oe}=F(),[W,ie]=a.useState(0),{user:w}=F(),le=ye(),[re]=a.useState(w?.linkedAccounts.length||0),[H,ce]=a.useState(""),[se,de]=a.useState(""),[ue,q]=a.useState(!1),{hasTabbedAway:ge}=(function(){let[t,n]=a.useState(!1),o=a.useCallback((()=>{document.hidden&&n(!0)}),[]);return a.useEffect((()=>(document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o))),[o]),{hasTabbedAway:t,reset:()=>n(!1)}})(),{enabled:pe,token:z}=Ce(),x=Ee(e?.connector?.walletClientType||"unknown"),T=y.isMobile&&e?.connector?.connectorType==="wallet_connect_v2"||y.isMobile&&e?.connector?.connectorType==="coinbase_wallet"||y.isMobile&&e?.connector?.connectorType==="base_account"||y.isMobile&&e?.connector?.connectorType==="injected"&&e?.connector?.walletClientType==="phantom"||y.isMobile&&e?.connector?.connectorType==="solana_adapter"&&e.connector.walletClientType==="mobile_wallet_adapter",S=e?.status==="connected",X=e?.status==="switching_to_supported_chain";a.useEffect((()=>{let t=f(),n=t instanceof J||t instanceof V?t:void 0;S&&e.connector?.chainType==="solana"&&e.connector?.walletClientType==="phantom"&&le(be)&&p?.login?.isSigningInWithLedgerSolana===void 0?l("ConnectLedgerScreen",!1):(S&&!n&&(!pe||z||R?B(e.connectedWallet,z,p?.login?.disableSignup,p?.login?.isSigningInWithLedgerSolana?"transaction":"plain").then((()=>{q(!0)})):(h({captchaModalData:{callback:o=>B(e.connectedWallet,o,p?.login?.disableSignup,p?.login?.isSigningInWithLedgerSolana?"transaction":"plain").then((()=>{q(!0)})),userIntentRequired:!1,onSuccessNavigateTo:"ConnectionStatusScreen",onErrorNavigateTo:"ErrorScreen"}}),l("CaptchaScreen",!1))),n instanceof V&&p?.login?.isSigningInWithLedgerSolana&&(n.messageType="transaction"),n&&T&&S&&!n.preparedMessage?n.buildMessage():n&&!T&&S&&(g||(async()=>{d(!0),b(void 0);try{e?.connector?.connectorType==="wallet_connect_v2"&&e?.connector?.walletClientType==="metamask"&&await _e(2500),await N()}catch(o){console.warn("Auto-prompted signature failed",o)}finally{d(!1)}})()))}),[W,S,ue]),a.useEffect((()=>{if(w&&c){let t=G-500;if(I?.legal.requireUsersAcceptTerms&&!w.hasAcceptedTerms){let o=setTimeout((()=>{l("AffirmativeConsentScreen")}),t);return()=>clearTimeout(o)}if(Oe(w,I.embeddedWallets)){let o=setTimeout((()=>{h({createWallet:{onSuccess:()=>{},onFailure:O=>{console.error(O),ae({eventName:"embedded_wallet_creation_failure_logout",payload:{error:O,screen:"ConnectionStatusScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),l("EmbeddedWalletOnAccountCreateScreen")}),t);return()=>clearTimeout(o)}ne();let n=setTimeout((()=>M({shouldCallAuthOnSuccess:!0,isSuccess:!0})),G);return()=>clearTimeout(n)}}),[w,c]);let P=t=>{if(t?.privyErrorCode!==E.ALLOWLIST_REJECTED){if(t?.privyErrorCode===E.USER_LIMIT_REACHED)return console.error(new Ae(t).toString()),void l("UserLimitReachedScreen");if(t?.privyErrorCode!==E.USER_DOES_NOT_EXIST)return t?.privyErrorCode===E.ACCOUNT_TRANSFER_REQUIRED&&t.data?.data?.nonce?(h({accountTransfer:{nonce:t.data?.data?.nonce,account:f()?.meta.address,displayName:t.data?.data?.account?.displayName,externalWalletMetadata:{walletClientType:f()?.meta.walletClientType,chainId:f()?.meta.chainId,connectorType:f()?.meta.connectorType},linkMethod:f()instanceof J?"siwe":"siws",embeddedWalletAddress:t.data?.data?.otherUser?.embeddedWalletAddress}}),void l("LinkConflictScreen")):void b(Me(t));l("AccountNotFoundScreen")}else l("AllowlistRejectionScreen")};async function N(){try{await te(),s(!0)}catch(t){P(t)}finally{d(!1)}}a.useEffect((()=>{e?.connectError&&P(e?.connectError)}),[e]),((t,n)=>{let o=a.useRef((()=>{}));a.useEffect((()=>{o.current=t})),a.useEffect((()=>{if(n!==null){let O=setInterval((()=>o.current()),n||0);return()=>clearInterval(O)}}),[n])})((()=>{let t=L==="wallet_connect_v2"&&e?.connector instanceof j?e.connector.redirectUri:void 0;t&&ce(t);let n=L==="wallet_connect_v2"&&e?.connector instanceof j?e.connector.fallbackUniversalRedirectUri:void 0;n&&de(n)}),e?.connector instanceof j&&!H?500:null);let L=e?.connector?.connectorType||"injected",D=e?.connector?.walletClientType||"unknown",$=x?.metadata?.shortName||x?.name||e?.connector?.walletBranding.name||"Browser Extension",Se=x?.image_url?.md||e?.connector?.walletBranding.icon||(t=>m.jsx(Te,{...t})),Y=$==="Browser Extension"?$.toLowerCase():$;i=c?_("connectionStatus.successfullyConnected",{walletName:Y}):u?_("connectionStatus.errorTitle",{errorMessage:u.message}):X?"Switching networks":S?g&&T?"Signing":"Sign to verify":`Waiting for ${Y}`;let r=_("connectionStatus.checkOtherWindows");c?r=re===(w?.linkedAccounts.length||0)?"Wallet was already linked.":"You're good to go!":W>=2&&u?r="Unable to connect wallet":u?r=u.detail:X?r="Switch your wallet to the requested network.":S&&T?r="Sign the message in your wallet to verify it belongs to you.":D==="metamask"&&y.isMobile?r="Click continue to open and connect MetaMask.":D==="metamask"?r="For the best experience, connect only one wallet at a time.":L==="wallet_connect"?r="Open your mobile wallet app to continue":L==="coinbase_wallet"?Re()||(r=Z(w)?"Continue with the Coinbase app. Not the right wallet? Reset your connection below.":"Confirm in the Coinbase app/popup to continue."):p?.login?.isSigningInWithLedgerSolana&&(r="Ledger requires a transaction to verify your identity. You'll sign a transaction that performs no onchain action.");let K=oe?.walletConnectors?.find((t=>t.walletClientType==="coinbase_wallet")),fe=D==="coinbase_wallet"&&(Z(w)||u===C.ERROR_USER_EXISTS);return m.jsx(xe,{walletLogo:Se,title:i,subtitle:r,signSuccess:c,errorMessage:u,connectSuccess:S,separateConnectAndSign:T,signing:g,walletConnectRedirectUri:H,walletConnectFallbackUniversalUri:se,hasTabbedAway:ge,showCoinbaseWalletResetCta:fe,numRetries:W,onBack:A&&U!==A?k:void 0,onSign:()=>{d(!0),N()},onRetry:()=>{ie(W+1),b(void 0),S?(d(!0),N()):e?.connectRetry()},onCoinbaseReset:()=>{K&&K?.disconnect()},onDifferentWallet:k})}};let Ne=Le.p`
  text-align: center;
  color: var(--privy-color-foreground-2);
  font-size: 14px;
  line-height: 22px;
  margin: 16px 0;
`;export{Pe as ConnectionStatusScreen,xe as ConnectionStatusView,Pe as default,Me as getErrorDetails};

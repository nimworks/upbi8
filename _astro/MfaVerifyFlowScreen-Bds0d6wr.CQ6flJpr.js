import{dz as x,d5 as B,eD as E,d6 as f}from"./app.Dbs6V_q1.js";import{r}from"./index.Crn7-fJZ.js";import{Q as C,R as j,z as A,X as g}from"./to-ui-error-fYkDcQhz.asSa8VyB.js";import"./PinInput-3SLvbnQa.DL2jOvCl.js";import"./FingerPrintIcon.f1l06IJ0.js";import"./PhoneIcon.BLDp5Qmc.js";import"./ShieldCheckIcon.C49qVTY6.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";import"./ExclamationTriangleIcon.CbWlQoeb.js";import"./StackedContainer-B2vaEl56.CD0ocOGA.js";import"./useGetTokenPrice-YObgUU6L.Bdidc-9R.js";import"./useGetSolPrice-DwwjjGbd.Cs3YiPXK.js";import"./TransactionDetails-BMVu0qlz.59B78Oj6.js";import"./WalletLink-CZTmkBKu.CwUyBa3G.js";import"./ethers-DrSqg5wi.D-a06N_R.js";import"./getFormattedUsdFromLamports-B6EqSEho.C-HCdwKa.js";import"./transaction-CnfuREWo.DxjkYrBU.js";import"./Layouts-BlFm53ED.DNAcEX9b.js";import"./ChevronDownIcon.zw1eklKi.js";const Z=({onClose:n})=>{let{user:l}=x(),p=B(),a=r.useMemo((()=>l?.mfaMethods.filter((e=>e!=="passkey"||!p.globalDisablePasskeys))??[]),[l?.mfaMethods,p.globalDisablePasskeys]),[o,i]=r.useState(a[0]??null),{init:d,cancel:w,submit:h}=E(),[y,k]=r.useState(!1),[v,M]=r.useState(null),[c,s]=r.useState();r.useEffect((()=>{i(a[0]??null)}),[a]);let m=r.useRef(!1);async function S(e){s(void 0);try{if(!e||!o)return;await h(o,e),k(!0),s(void 0),n()}catch(t){throw g(t).error}}async function b(e){if(e!=="passkey")try{i(e),await d(e)}catch(t){console.error(t)}else try{i(e);let t=await d(e);if(!t)throw Error("something went wrong");M(t),await h(e,t),k(!0),s(void 0),n()}catch(t){s(g(t))}}r.useEffect((()=>{!m.current&&o&&(m.current=!0,b(o).finally((()=>{m.current=!1})))}),[]);let u=()=>{i(null),s(void 0),w(),n()};return l?o==="passkey"?f.jsx(C,{account:l.linkedAccounts.filter((e=>e.type==="passkey"&&e.enrolledInMfa)).sort(((e,t)=>t.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf()))[0],submitSuccess:y,hasBlockingError:c?.isBlocking??!1,error:c?.error,onClose:u,onBack:()=>{i(null),s(void 0)},handleSubmit:()=>S(v).catch(s)}):o?f.jsx(j,{submitSuccess:y,hasBlockingError:c?.isBlocking??!1,handleSubmitCode:S,selectedMethod:o,onClose:u,onBack:a.length>1?()=>i(null):void 0}):f.jsx(A,{mfaMethods:a,onSelect:b,handleClose:u}):null};export{Z as MfaVerifyFlowScreen,Z as default};

import{d5 as D,d7 as Se,d4 as Te,db as we,dc as be,bu as xe,cA as Ce,dd as ye,de as g,df as B,da as v,c as Ee,h as Ne,dg as Fe,bY as x,dh as Ae,d6 as i}from"./app.Dbs6V_q1.js";import{F as $e}from"./CheckCircleIcon.DG4NyxCY.js";import{r as a}from"./index.Crn7-fJZ.js";import{c as Ue,n as je,s as Be}from"./Layouts-BlFm53ED.DNAcEX9b.js";import{b as V}from"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import{o as Pe}from"./ScreenHeader-CHmc4-Lu.CDB8Kfz5.js";import{t as Q}from"./FundWalletMethodHeader-Dujd1j7J.DOTw7rnz.js";import{t as ke}from"./index-Dq_xe9dz.CYFAvuPJ.js";import{c as Le,t as Me}from"./useGetTokenPrice-YObgUU6L.Bdidc-9R.js";import{t as Y}from"./analytics-mkkvFRju.DOXuftJB.js";import{u as Z,o as z,s as G,r as J,d as K,f as qe}from"./reservoir-0wfhnc0j.e4oV4U26.js";import{e as Oe}from"./getChainName-DjpPdUSc.c2urPd0g.js";import{t as We,n as He}from"./transaction-CnfuREWo.DxjkYrBU.js";import{Q as Re,Z as _e}from"./BridgeNetworkSelectionView-0VRZoDMv.C8_i9FW3.js";import{I as De}from"./TransferOrBridgeLoadingScreen-gM_oel5i.B9Paf-ub.js";import{c as Ve}from"./custom.BLgW5Lf4.js";import"./useGetSolPrice-DwwjjGbd.Cs3YiPXK.js";import"./getFormattedUsdFromLamports-B6EqSEho.C-HCdwKa.js";import"./getErc20Balance-D0MGUaOw.CZLXP-aV.js";import"./Value-tcJV9e0L.CCQPdIyi.js";import"./LoadingSkeleton-U6-3yFwI.DhgKuR2U.js";import"./ErrorMessage-D8VaAP5m.NPlgZ3Xt.js";import"./Subtitle-CV-2yKE4.DJhYHDeo.js";import"./Title-BnzYV3Is.B74pnAvd.js";import"./WalletIcon.DW8etFtk.js";import"./Chip-D2-wZOHJ.DezdPRVM.js";import"./shared-FM0rljBt.uRznKemR.js";import"./ChevronDownIcon.zw1eklKi.js";import"./formatErc20TokenAmount-BuPk9xcy.CkAr4Oc0.js";import"./ethers-DrSqg5wi.D-a06N_R.js";import"./styles-C3H3yhVT.DXoQsb_B.js";import"./LinkPasskeyScreen-jzRj6Yq0.CHUIblrj.js";import"./TodoList-CgrU7uwu.CdzoNajJ.js";import"./createLucideIcon.RSj0tFkk.js";import"./check.BWO2M5QN.js";import"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./circle-check-big.BEG3gtjL.js";import"./fingerprint-pattern.Bk_3pvPW.js";import"./formatters.DtIZsRmK.js";import"./InjectedWalletIcon-DLcYOGDj.CyAbXwSp.js";import"./Address-BuCMjci7.5xYW3BaW.js";import"./copy.Ukg_M5w7.js";import"./GlobeAltIcon.TtWhTJWd.js";const Lt={component:()=>{let X=D(),{rpcConfig:P,appId:I,closePrivyModal:ee,createAnalyticsEvent:k}=Se(),{navigate:te,setModalData:ae,data:d}=Te(),L=D(),{wallets:ne}=we(),[C,m]=a.useState(null),[ie,y]=a.useState(null),[p,re]=a.useState([]),[M,se]=a.useState(0),[q,E]=a.useState(!1),[O,S]=a.useState(!1),[N,F]=a.useState(!1),[A,W]=a.useState(!1),[oe,de]=a.useState(),[le,H]=a.useState();if(!d?.funding||d.funding.chainType!=="solana")throw Error("Invalid funding data");let{address:u,chain:T,connectedWallet:R}=d.funding,[w,ce]=a.useState(d.funding.amount),t=(R?.type==="ethereum"?R:void 0)??ne[0],ue=be(t?.walletClientType||"unknown"),_=ue?.name||"wallet",[l,me]=a.useState(null);a.useEffect((()=>{(async()=>{if(!t)return;let e=await t.getEthereumProvider();me(xe({account:t.address,transport:Ve(e)}).extend(Ce))})().catch(console.error)}),[t]);let[pe,fe]=a.useState(0n),he=We(pe);a.useEffect((()=>{let e=X.solanaRpcs[T];e?ye({rpc:e.rpc,address:u}).then((s=>fe(BigInt(s)))).catch(console.error):console.warn("Unable to load solana rpc, skipping balance")}),[]);let[n,$]=a.useState(),{tokenPrice:ge}=Le("solana"),{fundingAmountInBaseUnit:b,fundingAmountInUsd:ve}=He({amount:w,fee:0n,tokenPrice:ge,isUsdc:d.funding.isUSDC});if(a.useEffect((()=>{(async()=>{if(!l||!t)return;let e=["solana:testnet","solana:devnet"].includes(T);e&&console.warn("Solana testnets are not supported for bridging");let s=Me(L.chains).filter((({testnet:r})=>!!r===e)),f=(await Re({chains:s,address:t.address,appId:I,rpcConfig:P})).filter((r=>r.balance>0n));if(f.length<1)return void m(new g(`Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));f.sort(((r,j)=>Number(j.balance-r.balance)));let o=(await Promise.allSettled(f.map((async r=>({...r,quote:await Z({isTestnet:!1,input:z({appId:I,amount:b.toString(),user:t.address,recipient:u,destinationChainId:J,destinationCurrency:G,originChainId:r.chain.id})})}))))).filter((r=>r.status==="fulfilled")).map((r=>r.value));if(o.length<1)return void m(new g(`Unable to fetch quotes for bridging. Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));let U=o.map((({quote:r,balance:j,chain:Ie})=>({bridgeTx:K(r),balance:j,chain:Ie,isErc20Quote:!1}))).filter((({bridgeTx:r})=>!!r));if(U.length>1)return void re(U);let h=U.at(0);h?(S(!0),$({data:h.bridgeTx.data,to:h.bridgeTx.to,value:h.bridgeTx.value,chain:h.chain})):m(new g(`Unable to select bridge option from quotes. Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE))})().catch(console.error)}),[l]),a.useEffect((()=>{(async()=>{let e,s;if(!l||!t||q||N||!n)return;E(!0);let f=Ee({chain:n.chain,transport:Ne(Fe(n.chain,P,I))});try{e=await f.prepareTransactionRequest({account:t.address,to:n.to,chain:n.chain,data:n.data,value:BigInt(n.value??0)})}catch(o){console.error(o),p.length>1&&y(o.shortMessage??"Something went wrong")}if(e){E(!1),F(!0);try{await l.switchChain({id:n.chain.id})}catch{await l.addChain({chain:n.chain}),await l.switchChain({id:n.chain.id})}try{s=await l.sendTransaction(e)}catch(o){console.error(o),o.name==="TransactionExecutionError"&&(p.length<1?m(new g(o.shortMessage,void 0,v.TRANSACTION_FAILURE)):y(o.shortMessage??"Something went wrong"))}if(s)return await l.waitForTransactionReceipt({hash:s}),O?(H("pending"),void de(s)):(F(!1),W(!0),void k({eventName:Y,payload:{provider:"external",status:"success",txHash:s,address:t.address,chainId:n.chain.id,chainType:"ethereum",value:n.value?x(BigInt(n.value),18):void 0,token:"ETH",destination:u,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:x(b,9),destinationToken:"SOL"}}));F(!1)}else E(!1)})().catch(console.error)}),[l,n]),qe({transactionHash:oe,isTestnet:!1,bridgingStatus:le,setBridgingStatus:H,onSuccess({transactionHash:e}){S(!1),W(!0),k({eventName:Y,payload:{provider:"external",status:"success",txHash:e,address:t?.address,chainId:n?.chain.id,chainType:"ethereum",value:n?.value?x(BigInt(n.value),18):void 0,token:"ETH",destination:u,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:x(b,9),destinationToken:"SOL"}})},onFailure({error:e}){S(!1),m(e)}}),a.useEffect((()=>{C&&(ae({funding:d?.funding,solanaFundingData:d?.solanaFundingData,sendTransaction:d?.sendTransaction,errorModalData:{error:C,previousScreen:"TransferFromWalletScreen"}}),te("ErrorScreen",!1))}),[C]),a.useEffect((()=>{if(!A)return;let e=setTimeout(ee,Ae);return()=>clearTimeout(e)}),[A]),A)return i.jsxs(i.Fragment,{children:[i.jsx(Q,{}),i.jsx(Ue,{}),i.jsxs(je,{children:[i.jsx($e,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),i.jsx(Pe,{title:"Success!",description:`Youâ€™ve successfully added ${w} SOL to your ${L.name} wallet. It may take a minute before the funds are available to use.`})]}),i.jsx(Be,{}),i.jsx(V,{})]});let c=p[M];return p.length>1&&c?i.jsx(_e,{displayName:_,configuredFundingChain:T,formattedBalance:he,fundingAmount:w,fundingCurrency:"SOL",fundingAmountInUsd:ve,options:p,selectedOption:c,isPreparing:q,isSubmitting:N,addressToFund:u,fundingWalletAddress:t?.address||"",errorMessage:ie,onSubmit:()=>{d.funding?.amount!==w?(async function(){if(t&&c)try{let e=await Z({isTestnet:!1,input:z({appId:I,amount:b.toString(),user:t.address,recipient:u,destinationChainId:J,destinationCurrency:G,originChainId:c.chain.id})}),s=K(e);if(!s)throw Error("Invalid transaction request");S(!0),$({data:s.data,to:s.to,value:s.value,chain:c.chain})}catch(e){console.error(e),m(new g("Unable to fetch quotes for bridging",e,v.INSUFFICIENT_BALANCE))}})().catch(console.error):$({to:c.bridgeTx.to,data:c.bridgeTx.data,value:c.bridgeTx.value,chain:c.chain})},onSelect:e=>{e!==M&&(y(null),se(e))},onAmountChange:ce}):N&&t?i.jsx(De,{walletClientType:t?.walletClientType||"unknown",displayName:_,addressToFund:u,isBridging:O,isErc20Flow:!1,chainId:"solana",chainName:Oe(T),totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):i.jsxs(i.Fragment,{children:[i.jsx(Q,{}),i.jsx(ke,{}),i.jsx("div",{style:{marginTop:"1rem"}}),i.jsx(V,{})]})}};export{Lt as AwaitingEvmToSolBridgingScreen,Lt as default};

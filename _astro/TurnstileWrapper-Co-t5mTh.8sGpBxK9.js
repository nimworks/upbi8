import{d6 as U}from"./app.Dbs6V_q1.js";import{r as o}from"./index.Crn7-fJZ.js";var re=({as:n="div",...s},i)=>U.jsx(n,{...s,ref:i}),te=o.forwardRef(re),ne="https://challenges.cloudflare.com/turnstile/v0/api.js",$="cf-turnstile-script",oe="cf-turnstile",A="onloadTurnstileCallback",q=n=>!!document.getElementById(n),ie=({render:n="explicit",onLoadCallbackName:s=A,scriptOptions:{nonce:i="",defer:e=!0,async:l=!0,id:x="",appendTo:f,onError:w,crossOrigin:p=""}={}})=>{let u=x||$;if(q(u))return;let c=document.createElement("script");c.id=u,c.src=`${ne}?onload=${s}&render=${n}`,!document.querySelector(`script[src="${c.src}"]`)&&(c.defer=!!e,c.async=!!l,i&&(c.nonce=i),p&&(c.crossOrigin=p),w&&(c.onerror=w,delete window[s]),(f==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(c))},g={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function ae(n){if(n!=="invisible"&&n!=="interactionOnly")return n}function ce(n=$){let[s,i]=o.useState(!1);return o.useEffect(()=>{let e=()=>{q(n)&&i(!0)},l=new MutationObserver(e);return l.observe(document,{childList:!0,subtree:!0}),e(),()=>{l.disconnect()}},[n]),s}var C="unloaded",H,ue=new Promise((n,s)=>{H={resolve:n,reject:s},C==="ready"&&n(void 0)}),_=(n=A)=>(C==="unloaded"&&(C="loading",window[n]=()=>{H.resolve(),C="ready",delete window[n]}),ue),G=o.forwardRef((n,s)=>{let{scriptOptions:i,options:e={},siteKey:l,onWidgetLoad:x,onSuccess:f,onExpire:w,onError:p,onBeforeInteractive:u,onAfterInteractive:c,onUnsupported:O,onTimeout:N,onLoadScript:P,id:J,style:V,as:X="div",injectScript:z=!0,rerenderOnCallbackChange:a=!1,...M}=n,d=e.size,D=o.useCallback(()=>typeof d>"u"?{}:e.execution==="execute"?g.invisible:e.appearance==="interaction-only"?g.interactionOnly:g[d],[e.execution,d,e.appearance]),[Q,k]=o.useState(D()),m=o.useRef(null),[E,B]=o.useState(!1),t=o.useRef(void 0),I=o.useRef(!1),K=J||oe,h=o.useRef({onSuccess:f,onError:p,onExpire:w,onBeforeInteractive:u,onAfterInteractive:c,onUnsupported:O,onTimeout:N});o.useEffect(()=>{a||(h.current={onSuccess:f,onError:p,onExpire:w,onBeforeInteractive:u,onAfterInteractive:c,onUnsupported:O,onTimeout:N})});let F=i?.id||$,j=ce(F),R=i?.onLoadCallbackName||A,Y=e.appearance||"always",S=o.useMemo(()=>({sitekey:l,action:e.action,cData:e.cData,theme:e.theme||"auto",language:e.language||"auto",tabindex:e.tabIndex,"response-field":e.responseField,"response-field-name":e.responseFieldName,size:ae(d),retry:e.retry||"auto","retry-interval":e.retryInterval||8e3,"refresh-expired":e.refreshExpired||"auto","refresh-timeout":e.refreshTimeout||"auto",execution:e.execution||"render",appearance:e.appearance||"always","feedback-enabled":e.feedbackEnabled||!0,callback:r=>{I.current=!0,a?f?.(r):h.current.onSuccess?.(r)},"error-callback":a?p:(...r)=>h.current.onError?.(...r),"expired-callback":a?w:(...r)=>h.current.onExpire?.(...r),"before-interactive-callback":a?u:(...r)=>h.current.onBeforeInteractive?.(...r),"after-interactive-callback":a?c:(...r)=>h.current.onAfterInteractive?.(...r),"unsupported-callback":a?O:(...r)=>h.current.onUnsupported?.(...r),"timeout-callback":a?N:(...r)=>h.current.onTimeout?.(...r)}),[e.action,e.appearance,e.cData,e.execution,e.language,e.refreshExpired,e.responseField,e.responseFieldName,e.retry,e.retryInterval,e.tabIndex,e.theme,e.feedbackEnabled,e.refreshTimeout,l,d,a,a?f:null,a?p:null,a?w:null,a?u:null,a?c:null,a?O:null,a?N:null]),y=o.useCallback(()=>typeof window<"u"&&!!window.turnstile,[]);return o.useEffect(function(){z&&!E&&(_(R),ie({onLoadCallbackName:R,scriptOptions:{...i,id:F}}))},[z,E,i,F,R]),o.useEffect(function(){C!=="ready"&&_(R).then(()=>B(!0)).catch(console.error)},[R]),o.useEffect(function(){if(!m.current||!E)return;let r=!1;return(async()=>{if(r||!m.current)return;let v=window.turnstile.render(m.current,S);t.current=v,t.current&&x?.(t.current)})(),()=>{r=!0,t.current&&(window.turnstile.remove(t.current),I.current=!1)}},[K,E,S]),o.useImperativeHandle(s,()=>{let{turnstile:r}=window;return{getResponse(){if(!r?.getResponse||!t.current||!y()){console.warn("Turnstile has not been loaded");return}return r.getResponse(t.current)},async getResponsePromise(v=3e4,Z=100){return new Promise((ee,L)=>{let b,W=async()=>{if(I.current&&window.turnstile&&t.current)try{let T=window.turnstile.getResponse(t.current);return b&&clearTimeout(b),T?ee(T):L(new Error("No response received"))}catch(T){return b&&clearTimeout(b),console.warn("Failed to get response",T),L(new Error("Failed to get response"))}b||(b=setTimeout(()=>{b&&clearTimeout(b),L(new Error("Timeout"))},v)),await new Promise(T=>setTimeout(T,Z)),await W()};W()})},reset(){if(!r?.reset||!t.current||!y()){console.warn("Turnstile has not been loaded");return}e.execution==="execute"&&k(g.invisible);try{I.current=!1,r.reset(t.current)}catch(v){console.warn(`Failed to reset Turnstile widget ${t}`,v)}},remove(){if(!r?.remove||!t.current||!y()){console.warn("Turnstile has not been loaded");return}k(g.invisible),I.current=!1,r.remove(t.current),t.current=null},render(){if(!r?.render||!m.current||!y()||t.current){console.warn("Turnstile has not been loaded or container not found");return}let v=r.render(m.current,S);return t.current=v,t.current&&x?.(t.current),e.execution!=="execute"&&k(d?g[d]:{}),v},execute(){if(e.execution!=="execute"){console.warn('Execution mode is not set to "execute"');return}if(!r?.execute||!m.current||!t.current||!y()){console.warn("Turnstile has not been loaded or container not found");return}r.execute(m.current,S),k(d?g[d]:{})},isExpired(){return!r?.isExpired||!t.current||!y()?(console.warn("Turnstile has not been loaded"),!1):r.isExpired(t.current)}}},[t,e.execution,d,S,m,y,E,x]),o.useEffect(()=>{if(E||!j)return;if(window.turnstile){B(!0);return}let r=setInterval(()=>{window.turnstile&&(B(!0),clearInterval(r))},50);return()=>{clearInterval(r)}},[E,j]),o.useEffect(()=>{k(D())},[e.execution,d,Y]),o.useEffect(()=>{!j||typeof P!="function"||P()},[j]),U.jsx(te,{ref:m,as:X,id:K,style:{...Q,...V},...M})});G.displayName="Turnstile";const de=({delayedExecution:n,captchaContext:s,...i})=>{let{appId:e,setError:l,setToken:x,setExecuting:f,siteKey:w,ref:p}=s;return U.jsx(G,{...i,ref:p,siteKey:w??"",options:{action:e,size:"invisible",...n?{appearance:"execute",execution:"execute"}:{appearance:"always",execution:"render"}},onUnsupported:()=>{i.onUnsupported?.(),console.warn("Browser does not support Turnstile.")},onError:u=>{i.onError?.(u),l("Captcha failed"),f(!1)},onSuccess:u=>{i.onSuccess?.(u),x(u),f(!1)},onExpire:u=>{i.onExpire?.(u);try{p.current?.reset(),l(void 0),x(void 0)}catch{l("expired_and_failed_reset")}}})};export{de as TurnstileWrapper,de as default};

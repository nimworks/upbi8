import{r as l}from"./index.Crn7-fJZ.js";import{d5 as d,e4 as m,e5 as u,e6 as h,de as b,da as g}from"./app.Dbs6V_q1.js";function w(r){return new Uint8Array(m().decode(r).messageBytes)}async function R({solanaClient:r,tx:t}){let e=u().decode(w(t)),{value:n}=await r.rpc.getFeeForMessage(e).send();return n??0n}async function E({solanaClient:r,tx:t,replaceRecentBlockhash:e}){let{value:n}=await r.rpc.simulateTransaction(u().decode(t),{commitment:"confirmed",encoding:"base64",sigVerify:!1,replaceRecentBlockhash:e}).send();if(n.err==="BlockhashNotFound"&&e)throw Error("Simulation failed: Blockhash not found");return n.err==="BlockhashNotFound"?await E({solanaClient:r,tx:t,replaceRecentBlockhash:!0}):{logs:n.logs??[],error:n.err,hasError:!!n.err,hasFunds:n.logs?.every((o=>!/insufficient funds/gi.test(o)&&!/insufficient lamports/gi.test(o)))??!0}}const y=(...r)=>{if(typeof Buffer>"u")throw new b("Buffer is not defined.",void 0,g.BUFFER_NOT_DEFINED);return Buffer.from(...r)};async function B({rpcSubscriptions:r,signature:t,timeout:e}){let n=new AbortController,o=await r.signatureNotifications(t,{commitment:"confirmed"}).subscribe({abortSignal:n.signal}),s=await Promise.race([new Promise((a=>{setTimeout((()=>{n.abort(),a(Error("Transaction confirmation timed out"))}),e)})),new Promise((async a=>{for await(let c of o){if(n.abort(),c.value.err)return a(Error("Transaction confirmation failed"));a(void 0)}}))]);if(s instanceof Error)throw s}function k({rpc:r,rpcSubscriptions:t,chain:e,blockExplorerUrl:n}){let o=(function({rpc:s,rpcSubscriptions:a}){return async c=>new Promise((async(f,p)=>{try{let i=await s.sendTransaction(y(c).toString("base64"),{preflightCommitment:"confirmed",encoding:"base64"}).send();await B({rpcSubscriptions:a,signature:i,timeout:1e4}),f({signature:new Uint8Array(h().encode(i))})}catch(i){p(i)}}))})({rpc:r,rpcSubscriptions:t});return{rpc:r,rpcSubscriptions:t,chain:e,blockExplorerUrl:n,sendAndConfirmTransaction:o}}function C(){let r=d(),t=l.useMemo((()=>Object.fromEntries(["solana:mainnet","solana:devnet","solana:testnet"].map((e=>[e,r.solanaRpcs[e]?k({chain:e,rpc:r.solanaRpcs[e].rpc,rpcSubscriptions:r.solanaRpcs[e].rpcSubscriptions,blockExplorerUrl:r.solanaRpcs[e].blockExplorerUrl??`https://explorer.solana.com?cluster=${e.replace("solana:","")}`}):null])))),[r.solanaRpcs]);return l.useCallback((e=>{if(!t[e])throw Error(`No RPC configuration found for chain ${e}`);return t[e]}),[t])}export{w as c,C as d,y as f,R as l,B as p,E as u};

import{dz as M,d4 as D,d5 as I,d7 as U,dp as x,dv as g,d6 as E,ew as v,dq as N,da as d,dI as O}from"./app.Dbs6V_q1.js";import{r as m}from"./index.Crn7-fJZ.js";import{a as j}from"./shouldProceedtoEmbeddedWalletCreationFlow-BfZwb-3N.vvASFTgn.js";import{n as k}from"./ScreenLayout-C2Le_YIv.CCTYs10k.js";import{c as F}from"./telegram-B-JqnkqZ.qaLatBqp.js";import"./ModalHeader-CSfzkWxZ.KQF0IT9H.js";import"./Screen-5StC6JLQ.BNbtfsff.js";import"./index-Dq_xe9dz.CYFAvuPJ.js";const $=({success:r,errorMessage:a,onRetry:c})=>{let i=r?"Successfully connected with Telegram":a?a.message:"Verifying connection to Telegram";return E.jsx(k,{title:i,subtitle:r?"You're good to go!":a?a.detail:"Just a few moments more",icon:F,iconVariant:"loading",iconLoadingStatus:{success:r,fail:!!a},secondaryCta:a?.retryable&&c?{label:"Retry",onClick:c}:void 0,watermark:!0})},X={component:()=>{let{authenticated:r,logout:a,ready:c,user:i}=M(),{setModalData:A,navigate:l,resetNavigation:u,data:p}=D(),y=I(),{initLoginWithTelegram:R,loginWithTelegram:b,updateWallets:C,setReadyToTrue:w,closePrivyModal:_,createAnalyticsEvent:W,getAuthMeta:h}=U(),[f,L]=m.useState(!1),[S,o]=m.useState(void 0),s=x();async function T(){try{let e=await(async function(){let t;if(!r){if(s.enabled&&s.status==="error")throw new N(s.error,null,d.CAPTCHA_FAILURE);return s.enabled&&s.status!=="success"&&(s.execute(),t=await s.waitForResult()),t}})();await b({captchaToken:e}),L(!0),w(!0)}catch(e){if(e?.privyErrorCode===d.ALLOWLIST_REJECTED)return o(void 0),u(),void l("AllowlistRejectionScreen");if(e?.privyErrorCode===d.USER_LIMIT_REACHED)return console.error(new O(e).toString()),o(void 0),u(),void l("UserLimitReachedScreen");if(e?.privyErrorCode===d.USER_DOES_NOT_EXIST)return o(void 0),u(),void l("AccountNotFoundScreen");if(e?.privyErrorCode===d.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return o(void 0),u(),A({accountTransfer:{nonce:e.data?.data?.nonce,account:e.data?.data?.subject,telegramAuthResult:h()?.telegramAuthResult,telegramWebAppData:h()?.telegramWebAppData,displayName:e.data?.data?.account?.displayName,linkMethod:"telegram",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void l("LinkConflictScreen");let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}return m.useEffect((()=>{T()}),[]),m.useEffect((()=>{if(!(c&&r&&f&&i))return;if(y?.legal.requireUsersAcceptTerms&&!i.hasAcceptedTerms){let t=setTimeout((()=>{l("AffirmativeConsentScreen")}),g);return()=>clearTimeout(t)}if(j(i,y.embeddedWallets)){let t=setTimeout((()=>{A({createWallet:{onSuccess:()=>{},onFailure:n=>{console.error(n),W({eventName:"embedded_wallet_creation_failure_logout",payload:{error:n,provider:"telegram",screen:"TelegramAuthScreen"}}),a()},callAuthOnSuccessOnClose:!0}}),l("EmbeddedWalletOnAccountCreateScreen")}),g);return()=>clearTimeout(t)}C();let e=setTimeout((()=>_({shouldCallAuthOnSuccess:!0,isSuccess:!0})),g);return()=>clearTimeout(e)}),[c,r,f,i]),E.jsx($,{success:f,errorMessage:S,onRetry:S?.retryable?async()=>{try{o(void 0),p?.telegramAuthModalData?.seamlessAuth||await R(void 0,p?.login?.disableSignup),await T()}catch(e){let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}:void 0})},isCaptchaRequired:!0,isShownBeforeReady:!0};export{X as TelegramAuthScreen,$ as TelegramAuthScreenView,X as default};
